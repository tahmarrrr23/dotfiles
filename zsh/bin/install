#!/bin/sh
set -eu
cd "$(dirname "$0")"
[ -d "/opt/homebrew" ] && eval "$(/opt/homebrew/bin/brew shellenv)"

formula='zsh'
brew list $formula >/dev/null 2>&1 || brew install $formula

zsh_bin=$(brew --prefix)/bin/zsh
if ! grep -q "$zsh_bin" </etc/shells; then
  sudo sh -c "echo $zsh_bin >> /etc/shells"
  chsh -s "$zsh_bin"
else
  echo "skip"
fi

ZINIT_HOME="${XDG_DATA_HOME:-${HOME}/.local/share}/zinit/zinit.git"
[ ! -d "$ZINIT_HOME" ] && mkdir -p "$(dirname "$ZINIT_HOME")"
[ ! -d "$ZINIT_HOME"/.git ] && git clone https://github.com/zdharma-continuum/zinit.git "$ZINIT_HOME"

ln -s -f "../zshrc" "$HOME/.zshrc"
